<!doctype html>
<html lang='en'>

<head>
    <meta charset='utf-8' />
    <meta name='viewport' content='width=device-width,initial-scale=1' />
    <title>AgriConnect Organic ‚Äî Cart</title>
    <link rel='stylesheet' href='style.css'>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const navbarUserArea = document.getElementById("navbar-user-area");
            const currentUser = JSON.parse(localStorage.getItem("agriconnect_current_user"));

            function renderNavbar() {
                if (currentUser) {
                    navbarUserArea.innerHTML = `
                <a href="account.html" style="color: white; text-decoration: none; margin-right:20px;">My Account (${currentUser.fullname.split(" ")[0]})</a>
                <a href="#" id="logoutBtn" style="color: white; text-decoration: none;">Logout</a>
            `;

                    document.getElementById("logoutBtn").onclick = function () {
                        localStorage.removeItem("agriconnect_current_user");
                        window.location.reload();
                    };
                } else {
                    navbarUserArea.innerHTML = `
                <a href="login.html">Login</a>
                <a href="signup.html">Sign Up</a>
            `;
                }
            }

            renderNavbar();
        });
    </script>
</head>

<body>
    <header class="header">
        <div class="logo" onclick="location.href='index.html'"><img src="assets/siteLogo.png" alt="AgriConnect Organic" />
            <div style="display:flex;flex-direction:column;line-height:1">
                <div class="site-name" style="font-weight:700"></div>
                <div class="site-tagline small" style="opacity:0.9"></div>
            </div>
        </div>
        <nav style="background:#2f855a; padding:12px; color:white; display:flex; justify-content:space-between;">
            <div>
                <a href="home.html" style="color:white; text-decoration:none; margin-right:20px;">Home</a>
                <a href="products.html" style="color:white; text-decoration:none; margin-right:20px;">Products</a>
                <a href="sellers.html" style="color:white; text-decoration:none; margin-right:20px;">Sellers</a>
                <a href="cart.html" style="color: white; text-decoration: none; margin-right:100px;">Cart </a>
            </div>

            <div id="navbar-user-area">
                <!-- Filled by JS -->
            </div>
            
        </nav>
    </header>
    <main class='container' id='app'></main>
    <div id="cart-items-q"></div>

    <footer class="site-footer">
        <div>¬© <span id="year"></span> <span class="site-name"></span> ‚Äî All produce certified organic (OCCP)</div>
        <div class="lang-toggle">üåê <span data-i18n="language">Language</span>: <a href="#" class="lang-switch"
                data-lang="en" style="margin-left:8px">English</a> | <a href="#" class="lang-switch" data-lang="fil"
                style="margin-left:8px">Filipino</a></div>
    </footer>
    <script src='script.js'></script>
    <script>

        document.getElementById('year').textContent = new Date().getFullYear();

        function renderCart() {
            const c = getCart();

            if (!c.items.length) {
                document.getElementById('app').innerHTML = `
            <div class="card">
                <h3>Your cart is empty</h3>
                <div class="small">
                    Browse <a href='products.html'>products</a> to add items.
                </div>
            </div>
        `;
                return;
            }

            document.getElementById('app').innerHTML = `
        <section class="card">
            <h2>Your Cart</h2>
            <div id="cart-items-q" style="margin-top:12px"></div>
            <div style="margin-top:12px;text-align:right">
                <div style="font-weight:700">
                    Total: ‚Ç±<span id="cart-total">0</span>
                </div>
                <div style="margin-top:8px">
                    <button class="btn" onclick="location.href='checkout.html'">Proceed to checkout</button>
                </div>
            </div>
        </section>
    `;

            renderCartItems();
        }

        function renderCartItems() {
            const el = document.getElementById('cart-items-q');
            const c = getCart();

            el.innerHTML = c.items
                .map(function (it, idx) {
                    return `
                <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px">
                    <div style="flex:1">
                        <div style="font-weight:700">${it.title}</div>
                        <div class="small">‚Ç±${it.price} / ${it.unit}</div>
                    </div>
                    <div>
                        <input type="number" value="${it.qty}" min="0.1" step="0.1"
                            style="width:90px;padding:8px;border-radius:8px;border:1px solid #ddd"
                            onchange="updateQty(${idx}, this.value)" />
                    </div>
                    <div style="width:120px;text-align:right">
                        ‚Ç±${(it.price * it.qty).toFixed(2)}
                    </div>
                    <div>
                        <button class="btn secondary" onclick="removeFromCart(${idx})">Remove</button>
                    </div>
                </div>
            `;
                })
                .join('');

            document.getElementById('cart-total').textContent = c.items
                .reduce(function (s, i) {
                    return s + i.price * i.qty;
                }, 0)
                .toFixed(2);
        }

        function updateQty(idx, val) {
            const c = getCart();
            c.items[idx].qty = parseFloat(val);
            saveCart(c);
            renderCartItems();
            updateCartCount();
        }

        function removeFromCart(idx) {
            const c = getCart();
            c.items.splice(idx, 1);
            saveCart(c);
            updateCartCount();
            renderCart();
        }

        renderCart();
        applyTranslations();
        updateCartCount();

    </script>

</body>

</html>